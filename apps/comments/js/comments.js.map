{"version":3,"file":"comments.js","sources":["webpack:///webpack/bootstrap","webpack:///./apps/comments/src/activitytabviewplugin.js","webpack:///./apps/comments/src/app.js","webpack:///./apps/comments/src/comments.js","webpack:///./apps/comments/src/filesplugin.js","webpack:///./apps/comments/src/templates.js"],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/js/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./apps/comments/src/comments.js\");\n","/**\n * Copyright (c) 2016\n *\n * @author Joas Schilling <coding@schilljs.com>\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license GNU AGPL version 3 or any later version\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n(function () {\n  OCA.Comments.ActivityTabViewPlugin = {\n    /**\n     * Prepare activity for display\n     *\n     * @param {OCA.Activity.ActivityModel} model for this activity\n     * @param {jQuery} $el jQuery handle for this activity\n     * @param {string} view The view that displayes this activity\n     */\n    prepareModelForDisplay: function prepareModelForDisplay(model, $el, view) {\n      if (model.get('app') !== 'comments' || model.get('type') !== 'comments') {\n        return;\n      }\n\n      if (view === 'ActivityTabView') {\n        $el.addClass('comment');\n\n        if (model.get('message') && this._isLong(model.get('message'))) {\n          $el.addClass('collapsed');\n          var $overlay = $('<div>').addClass('message-overlay');\n          $el.find('.activitymessage').after($overlay);\n          $el.on('click', this._onClickCollapsedComment);\n        }\n      }\n    },\n\n    /*\n     * Copy of CommentsTabView._onClickComment()\n     */\n    _onClickCollapsedComment: function _onClickCollapsedComment(ev) {\n      var $row = $(ev.target);\n\n      if (!$row.is('.comment')) {\n        $row = $row.closest('.comment');\n      }\n\n      $row.removeClass('collapsed');\n    },\n\n    /*\n     * Copy of CommentsTabView._isLong()\n     */\n    _isLong: function _isLong(message) {\n      return message.length > 250 || (message.match(/\\n/g) || []).length > 1;\n    }\n  };\n})();\n\nOC.Plugins.register('OCA.Activity.RenderingPlugins', OCA.Comments.ActivityTabViewPlugin);","/**\n * Copyright (c) 2016 Vincent Petry <pvince81@owncloud.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n * @author Vincent Petry <vincent@nextcloud.com>\n *\n * @license GNU AGPL version 3 or any later version\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n(function () {\n  if (!OCA.Comments) {\n    /**\n     * @namespace\n     */\n    OCA.Comments = {};\n  }\n})();","/**\n * @copyright Copyright (c) 2016 Roeland Jago Douma <roeland@famdouma.nl>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n * @author Roeland Jago Douma <roeland@famdouma.nl>\n *\n * @license GNU AGPL version 3 or any later version\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport './app';\nimport './templates';\nimport './filesplugin';\nimport './activitytabviewplugin';\nwindow.OCA.Comments = OCA.Comments;","/**\n * Copyright (c) 2016 Vincent Petry <pvince81@owncloud.com>\n *\n * @author Joas Schilling <coding@schilljs.com>\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n * @author Michael Jobst <mjobst+github@tecratech.de>\n * @author Roeland Jago Douma <roeland@famdouma.nl>\n * @author Vincent Petry <vincent@nextcloud.com>\n *\n * @license GNU AGPL version 3 or any later version\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n(function () {\n  _.extend(OC.Files.Client, {\n    PROPERTY_COMMENTS_UNREAD: '{' + OC.Files.Client.NS_OWNCLOUD + '}comments-unread'\n  });\n\n  OCA.Comments = _.extend({}, OCA.Comments);\n\n  if (!OCA.Comments) {\n    /**\n     * @namespace\n     */\n    OCA.Comments = {};\n  }\n  /**\n   * @namespace\n   */\n\n\n  OCA.Comments.FilesPlugin = {\n    ignoreLists: ['trashbin', 'files.public'],\n    _formatCommentCount: function _formatCommentCount(count) {\n      return OCA.Comments.Templates.filesplugin({\n        count: count,\n        countMessage: n('comments', '%n unread comment', '%n unread comments', count),\n        iconUrl: OC.imagePath('core', 'actions/comment')\n      });\n    },\n    attach: function attach(fileList) {\n      var self = this;\n\n      if (this.ignoreLists.indexOf(fileList.id) >= 0) {\n        return;\n      }\n\n      var oldGetWebdavProperties = fileList._getWebdavProperties;\n\n      fileList._getWebdavProperties = function () {\n        var props = oldGetWebdavProperties.apply(this, arguments);\n        props.push(OC.Files.Client.PROPERTY_COMMENTS_UNREAD);\n        return props;\n      };\n\n      fileList.filesClient.addFileInfoParser(function (response) {\n        var data = {};\n        var props = response.propStat[0].properties;\n        var commentsUnread = props[OC.Files.Client.PROPERTY_COMMENTS_UNREAD];\n\n        if (!_.isUndefined(commentsUnread) && commentsUnread !== '') {\n          data.commentsUnread = parseInt(commentsUnread, 10);\n        }\n\n        return data;\n      });\n      fileList.$el.addClass('has-comments');\n      var oldCreateRow = fileList._createRow;\n\n      fileList._createRow = function (fileData) {\n        var $tr = oldCreateRow.apply(this, arguments);\n\n        if (fileData.commentsUnread) {\n          $tr.attr('data-comments-unread', fileData.commentsUnread);\n        }\n\n        return $tr;\n      }; // register \"comment\" action for reading comments\n\n\n      fileList.fileActions.registerAction({\n        name: 'Comment',\n        displayName: function displayName(context) {\n          if (context && context.$file) {\n            var unread = parseInt(context.$file.data('comments-unread'), 10);\n\n            if (unread >= 0) {\n              return n('comments', '1 new comment', '{unread} new comments', unread, {\n                unread: unread\n              });\n            }\n          }\n\n          return t('comments', 'Comment');\n        },\n        mime: 'all',\n        order: -140,\n        iconClass: 'icon-comment',\n        permissions: OC.PERMISSION_READ,\n        type: OCA.Files.FileActions.TYPE_INLINE,\n        render: function render(actionSpec, isDefault, context) {\n          var $file = context.$file;\n          var unreadComments = $file.data('comments-unread');\n\n          if (unreadComments) {\n            var $actionLink = $(self._formatCommentCount(unreadComments));\n            context.$file.find('a.name>span.fileactions').append($actionLink);\n            return $actionLink;\n          }\n\n          return '';\n        },\n        actionHandler: function actionHandler(fileName, context) {\n          context.$file.find('.action-comment').tooltip('hide'); // open sidebar in comments section\n\n          OCA.Files.Sidebar.setActiveTab('comments');\n          OCA.Files.Sidebar.open(context.dir + '/' + fileName);\n        }\n      }); // add attribute to \"elementToFile\"\n\n      var oldElementToFile = fileList.elementToFile;\n\n      fileList.elementToFile = function ($el) {\n        var fileInfo = oldElementToFile.apply(this, arguments);\n        var commentsUnread = $el.data('comments-unread');\n\n        if (commentsUnread) {\n          fileInfo.commentsUnread = commentsUnread;\n        }\n\n        return fileInfo;\n      };\n    }\n  };\n})();\n\nOC.Plugins.register('OCA.Files.FileList', OCA.Comments.FilesPlugin);","function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function () {\n  var template = Handlebars.template,\n      templates = OCA.Comments.Templates = OCA.Comments.Templates || {};\n  templates['filesplugin'] = template({\n    \"compiler\": [8, \">= 4.3.0\"],\n    \"main\": function main(container, depth0, helpers, partials, data) {\n      var helper,\n          alias1 = depth0 != null ? depth0 : container.nullContext || {},\n          alias2 = container.hooks.helperMissing,\n          alias3 = \"function\",\n          alias4 = container.escapeExpression,\n          lookupProperty = container.lookupProperty || function (parent, propertyName) {\n        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {\n          return parent[propertyName];\n        }\n\n        return undefined;\n      };\n\n      return \"<a class=\\\"action action-comment permanent\\\" title=\\\"\" + alias4((helper = (helper = lookupProperty(helpers, \"countMessage\") || (depth0 != null ? lookupProperty(depth0, \"countMessage\") : depth0)) != null ? helper : alias2, _typeof(helper) === alias3 ? helper.call(alias1, {\n        \"name\": \"countMessage\",\n        \"hash\": {},\n        \"data\": data,\n        \"loc\": {\n          \"start\": {\n            \"line\": 1,\n            \"column\": 50\n          },\n          \"end\": {\n            \"line\": 1,\n            \"column\": 66\n          }\n        }\n      }) : helper)) + \"\\\" href=\\\"#\\\">\\n\t<img class=\\\"svg\\\" src=\\\"\" + alias4((helper = (helper = lookupProperty(helpers, \"iconUrl\") || (depth0 != null ? lookupProperty(depth0, \"iconUrl\") : depth0)) != null ? helper : alias2, _typeof(helper) === alias3 ? helper.call(alias1, {\n        \"name\": \"iconUrl\",\n        \"hash\": {},\n        \"data\": data,\n        \"loc\": {\n          \"start\": {\n            \"line\": 2,\n            \"column\": 23\n          },\n          \"end\": {\n            \"line\": 2,\n            \"column\": 34\n          }\n        }\n      }) : helper)) + \"\\\"/>\\n</a>\\n\";\n    },\n    \"useData\": true\n  });\n})();"],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AClFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACtEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC7BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACpJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}